# 威胁检测系统设计文档

## 1. 系统架构

### 1.1 核心模块
- **数据收集器**（SystemCollector）：负责收集系统性能和网络数据
- **威胁检测器**（ThreatDetector）：分析数据并识别潜在威胁
- **事件存储**：使用SQLite存储威胁事件
- **响应处理器**：处理检测到的威胁并执行响应措施

### 1.2 数据流
```
SystemCollector -> ThreatDetector -> 威胁分析 -> 事件存储(SQLite) -> 响应处理
```

## 2. 数据库设计

### 2.1 为什么选择SQLite
1. **部署优势**
   - 零配置：不需要独立服务器和配置
   - 文件型数据库：直接嵌入应用程序
   - 部署简单：无需额外的数据库服务

2. **性能特点**
   - 适合写入为主的场景
   - 单文件存储，读写速度快
   - 支持完整的ACID事务

3. **维护优势**
   - 无需数据库管理员
   - 备份简单（复制文件即可）
   - 零维护成本

4. **适用场景**
   - 单机部署
   - 中小规模数据量
   - 简单的查询需求

### 2.2 数据表设计

#### 威胁事件表 (threat_events)
```sql
CREATE TABLE threat_events (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    level VARCHAR(20) NOT NULL,  -- LOW/MEDIUM/HIGH/WARNING/CRITICAL
    type VARCHAR(50) NOT NULL,   -- 威胁类型
    description TEXT,            -- 威胁描述
    timestamp DATETIME,          -- 发生时间
    source_ip VARCHAR(50),       -- 来源IP
    details JSON,               -- 详细信息
    status VARCHAR(20),         -- pending/processing/resolved
    resolution TEXT,            -- 解决方案
    resolved_at DATETIME        -- 解决时间
);
```

## 3. 监控指标

### 3.1 系统资源监控
- CPU使用率
- 内存使用情况
- 磁盘使用状况
- 进程活动

### 3.2 网络监控
- 网络流量统计
- 数据包统计
- 错误率监控
- 网络连接状态

## 4. 威胁检测规则

### 4.1 基础规则集
1. **网络异常检测**
   - 网络错误率超过1%
   - 异常流量模式

2. **系统资源异常**
   - CPU使用率 > 90%
   - 内存使用率 > 90%
   - 磁盘使用率 > 90%

3. **进程异常**
   - 高CPU进程数量异常
   - 高内存进程数量异常

## 5. 响应机制

### 5.1 威胁等级
- LOW：记录日志
- MEDIUM：通知管理员
- HIGH/CRITICAL：触发紧急响应

### 5.2 响应措施
1. **自动响应**
   - 记录详细日志
   - 发送告警通知
   - 执行预设的防御措施

2. **人工响应**
   - 管理员审查
   - 手动处理
   - 更新防御规则

## 6. 扩展性考虑

### 6.1 数据库迁移路径
如果未来需要扩展，可以平滑迁移到MySQL：
1. 需要多机部署时
2. 数据量显著增长
3. 需要主从复制
4. 需要更强并发能力

### 6.2 功能扩展
1. **规则引擎**
   - 可配置的检测规则
   - 规则优先级管理
   - 规则效果分析

2. **机器学习集成**
   - 异常检测模型
   - 行为模式分析
   - 预测性警告

3. **可视化界面**
   - 实时监控面板
   - 威胁事件分析
   - 系统性能展示 